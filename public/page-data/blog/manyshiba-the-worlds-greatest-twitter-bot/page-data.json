{"componentChunkName":"component---src-templates-post-js","path":"/blog/manyshiba-the-worlds-greatest-twitter-bot","result":{"data":{"markdownRemark":{"html":"<p>ManyShiba is the greatest Twitter bot ever created. Bless your soul with a daily photo of the almighty Shiba. Be uplifted by the spirit of this holy and sacred creature to free your soul.</p>\n<p>For so long, I felt that something was missing in my life. After being blessed by the presence of a divine Shiba Inu dog, I had my answer. I could cleanse my soul each day by reminding myself of this divine being. But that couldn’t be it, there had to be some way I could bless EVERYONE.</p>\n<p>Behold - your new favorite Twitter bot - @ManyShiba. (source code: <a href=\"https://github.com/spencerlepine/manyshiba-bot\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">GitHub</a>)</p>\n<h3>So what exactly is the ManyShiba Bot?</h3>\n<p>This is a simple Node.js app connected to the Twitter API. The app is deployed on <a href=\"https://dashboard.heroku.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Heroku</a>  and connected to the Twitter developer account.</p>\n<p>Each time the script runs, a new dog image will be fetched from the <a href=\"https://shibe.online/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Shibe.online</a> API. That image will then be uploaded and posted on the Twitter feed.</p>\n<h3>Technologies:</h3>\n<p>To build this app, there were three technologies I worked with.</p>\n<ul>\n<li><a href=\"https://nodejs.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Node.js</a></li>\n<li><a href=\"https://shibe.online/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Shibe.online API</a></li>\n<li><a href=\"https://www.npmjs.com/package/twit\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">twit</a></li>\n</ul>\n<p>Node is a popular Javascript runtime environment that can easily run on Heroku. Heroku is a PaaS and great tool to deploy a small app for free.</p>\n<p>The Shibe.online API is a third party service to retrieve a link for dog pictures. Since there are many random photos to use in that database, it is the perfect resource for finding many new photos.</p>\n<p>Finally, the twit library is a Twitter API Client for Node that simplifies the REST requests. Since this app will only be posting tweets, there are on advanced requests being made to the Twitter API.</p>\n<p>With each of these tools, we can have a functioning Twitter bot. Here are the steps for code:</p>\n<ul>\n<li>Save the Twitter API configuration</li>\n<li>Initialize the Twit Client with the configuration</li>\n<li>Fetch a random image from Shibe.online</li>\n<li>Convert the image from a URL to base64</li>\n<li>Tweet the image</li>\n</ul>\n<p>After registering a <a href=\"https://developer.twitter.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Twitter App</a>, make sure to enable Read/Write permissions in the App settings. Create an <code class=\"language-text\">.env</code> file in the root of the project based on <code class=\"language-text\">.env.example</code>. We can use this data in our file with an object like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> config <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  consumer_key<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">TWITTER_API_KEY</span><span class=\"token punctuation\">,</span>\n  consumer_secret<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">TWITTER_API_SECRET</span><span class=\"token punctuation\">,</span>\n  access_token<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">TWITTER_API_ACCESS_TOKEN</span><span class=\"token punctuation\">,</span>\n  access_token_secret<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">TWITTER_API_ACCESS_TOKEN_SECRET</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>In <code class=\"language-text\">app.js</code> we can import <code class=\"language-text\">twit</code> and pass along the config obj:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> twit <span class=\"token keyword\">from</span> <span class=\"token string\">'twit'</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">...</span>\n<span class=\"token keyword\">const</span> twitterClient <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">twit</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Before we tweet anything, we first need to generate the content to post. This is where we will retrieve an image from the Shibe.online API. Note, the Shibe endpoint will return a list of image URLs stored on a third party server. We must download this image, because posting an image URL does not actually display it on the feed.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token constant\">API_ENDPOINT</span> <span class=\"token operator\">=</span> <span class=\"token string\">'http://shibe.online/api/shibes?count=1&amp;urls=true&amp;httpsUrls=false'</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">...</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fetchRandomImage</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">tweetFunction</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> resultList <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token constant\">API_ENDPOINT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> newImage <span class=\"token operator\">=</span> resultList<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> newImage\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>After retrieving a URL from Shibe.online, we must fetch the image as well. We can convert the data from the image URL and convert it to a base64 string in memory. Since we are saving the image data, a Tweet will always load the image since it does not depend on the third party image database anymore.</p>\n<p>Note, you can use any library for HTTP requests like <a href=\"https://axios-http.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">axios</a>. This example uses the <code class=\"language-text\">http</code> and <code class=\"language-text\">node-fetch</code> libraries available on <a href=\"https://www.npmjs.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">npm</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> fetch <span class=\"token keyword\">from</span> <span class=\"token string\">'node-fetch'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> http <span class=\"token keyword\">from</span> <span class=\"token string\">'http'</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">...</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">urlToBase64</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">imgUrl<span class=\"token punctuation\">,</span> tweetFunction</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">await</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>imgUrl<span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">httpRes</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    httpRes<span class=\"token punctuation\">.</span><span class=\"token function\">setEncoding</span><span class=\"token punctuation\">(</span><span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Exclude -> \"data:\" + httpRes.headers[\"content-type\"] + \";base64,\";</span>\n    <span class=\"token keyword\">let</span> body <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">await</span> httpRes<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      body <span class=\"token operator\">+=</span> data<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">await</span> httpRes<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'end'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">tweetFunction</span><span class=\"token punctuation\">(</span>body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Got error: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>e<span class=\"token punctuation\">.</span>message<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fetchRandomImage</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">tweetFunction</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  <span class=\"token keyword\">await</span> <span class=\"token function\">urlToBase64</span><span class=\"token punctuation\">(</span>newImage<span class=\"token punctuation\">,</span> tweetFunction<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>With a base64 string, we need to upload it as media context to Twitter. After uploading it, we have access to a <code class=\"language-text\">media_id</code>. This media_id can be attached to the actual Tweet, which will cause the image to render on the feed. For this project, there is no text context attached to this Tweet.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">...</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">tweetImage</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">tweetContent</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>tweetContent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    twitterClient<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'media/upload'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> media_data<span class=\"token operator\">:</span> tweetContent <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> response</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// now we can assign alt text to the media, for use by screen readers and</span>\n      <span class=\"token comment\">// other text-based presentations and interpreters</span>\n      <span class=\"token keyword\">var</span> mediaIdStr <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>media_id_string\n      <span class=\"token keyword\">var</span> altText <span class=\"token operator\">=</span> <span class=\"token string\">\"Shiba Inu\"</span>\n      <span class=\"token keyword\">var</span> meta_params <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> media_id<span class=\"token operator\">:</span> mediaIdStr<span class=\"token punctuation\">,</span> alt_text<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> text<span class=\"token operator\">:</span> altText <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span>\n\n      twitterClient<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'media/metadata/create'</span><span class=\"token punctuation\">,</span> meta_params<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> response</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token comment\">// now we can reference the media and post a tweet (media will attach to the tweet)</span>\n          <span class=\"token keyword\">var</span> params <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> status<span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span> media_ids<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>mediaIdStr<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span>\n\n          twitterClient<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'statuses/update'</span><span class=\"token punctuation\">,</span> params<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> response</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">fetchRandomImage</span><span class=\"token punctuation\">(</span>tweetImage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>With each step tied together, we can retrieve Shiba images and generate Tweets with media content. To see the source code, head over to the <a href=\"https://github.com/spencerlepine/manyshiba-bot\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">GitHub repository</a>.</p>\n<p>With a working Twitter bot, I could run the script with Node on my local machine. However, it wouldn’t be automated if I had to run it manually. To solve this, I decided to deploy everything onto Heroku. This service allows node servers to run not just simple static files.</p>\n<p>With <a href=\"https://devcenter.heroku.com/articles/scheduler\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Heroku Scheduler</a>, you can configure script executions. Make sure to add this script to your <code class=\"language-text\">package.json</code> file:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  “scripts”<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    “start”<span class=\"token operator\">:</span> “node app<span class=\"token punctuation\">.</span>js”\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Adding a setting to execute the script on a timer makes the bot automated. I decided to let the bot create a daily Tweet with this tool. Our ManyShiba bot is now fully functional!</p>\n<hr>\n<p>View the source code on <a href=\"https://github.com/spencerlepine/manyshiba-bot\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">GitHub</a>.</p>\n<p>Also find me here:</p>\n<ul>\n<li><a href=\"https://twitter.com/SpencerLepine\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Twitter (@spencerlepine)</a></li>\n<li><a href=\"https://github.com/spencerlepine\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">GitHub (@spencerlepine)</a></li>\n<li><a href=\"https://www.linkedin.com/in/spencer-lepine/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">LinkedIn</a></li>\n<li><a href=\"https://www.youtube.com/channel/UCBL6vAHJZqUlyJp-rcFU55Q\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Youtube (Spencer Lepine)</a></li>\n</ul>","frontmatter":{"title":"ManyShiba - The World's Greatest Twitter Bot","description":"Exploration of building a custom Twitter Bot.","date":"2021-09-01T00:00:00.000Z","slug":"/blog/manyshiba-the-worlds-greatest-twitter-bot","tags":["GitHub","Twitter","Node","Bot"]}}},"pageContext":{}},"staticQueryHashes":["1033552414","1994492073","2404907192","604461682"]}