{"componentChunkName":"component---src-templates-post-js","path":"/blog/building-a-web-crawler-with-node-js","result":{"data":{"markdownRemark":{"html":"<p>Building a README Crawler with Node.js</p>\n<p>An Overview of the Node.js README Web Crawler project and how I created it.</p>\n<p>A recent project of mine was this Node.js <a href=\"https://spencerlepine.com/blog/building-a-web-crawler-with-node.js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">web crawler</a>. Working on that led to this idea for another crawler. I wanted a way to navigate through GitHub and search for obvious typos. I had this idea after stumbling across silly typos on numerous portfolio pages. Perhaps I could help fix these errors and ensure these projects/sites are more presentable.</p>\n<p>If youâ€™re interest in the final product, you can find the package <a href=\"https://www.npmjs.com/package/readme-crawler\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">here</a>, as well as the <a href=\"https://github.com/spencerlepine/readme-crawler\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">GitHub Repo</a>.</p>\n<p>The goal was to create a process for automatically navigating through repositories and creating a method for spell-checking what is found. Doing that manually is time consuming, so the computer will execute that process for us. A <a href=\"https://www.cloudflare.com/learning/bots/what-is-a-web-crawler/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">web crawler</a> will systematically browse different pages across the internet. The purpose of this specific crawler would be scraping GitHub only.</p>\n<p>Here's the breakdown of this problem:</p>\n<ul>\n<li>Fetch the HTML data from a URL</li>\n<li>Look at the README file displayed in that  DOM</li>\n<li>Export README and details README for later use</li>\n<li>Generate a list of repository links in displayed in README</li>\n</ul>\n<p>To execute the algorithm, we will use <a href=\"https://nodejs.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Node.js</a> (for the JavaScript runtime) and <a href=\"https://www.npmjs.com/package/node-fetch\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">node-fetch</a> (for network requests). This means we will run the code locally from the command line.\nFor this project, we will have an output folder to store all the README data, as well as a list (queue) of repository URLs to visit.\nBefore diving into the code, it is important to plan the input and output of the algorithm. For this web crawler, we will start at a valid GitHub repository page, which would be one URL string. After visiting each page with a README, we will export the data into a new file.\nNow lets cover the process of requesting a repository page from a URL. For this, we only care about saving the README file that is displayed, and we will ignore any other links that GitHub displays (such as the navbar). We will send a URL request with node-fetch, and retrieve the result of a HTML string. If we convert the HTML string to a DOM Tree, we can search for a specific element. GitHub stores the README file under a div with the class \"markdown-body\". We can use a library called 'jsdom' to use Browser API methods, and return a specific node.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fetchReadMeDOMFromRepoURL</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">url</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> destinationDOM<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> document <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JSDOM</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>window<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> readmeNode <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".markdown-body\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      destinationDOM <span class=\"token operator\">=</span> readmeNode<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">warn</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Could not fetch url: \"</span> <span class=\"token operator\">+</span> url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> destinationDOM<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now that we have access to a local node displaying the README content, we can export that data.\nInstead of using a spell checker at this stage, I decided to handle that separately and resort to a command-line alternative. This meant the README file could be exported to file locally, and then we process spell checking files after the crawler stops running.\nWith a README DOM node we will convert it from HTML to a markdown file. Websites give the browser HTML code to display.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">exportRepoDOM</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">readmeNode<span class=\"token punctuation\">,</span> repoURL<span class=\"token punctuation\">,</span> outputFolderPath</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>readmeNode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> name<span class=\"token punctuation\">,</span> owner<span class=\"token punctuation\">,</span> href <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">parseGitHubUrl</span><span class=\"token punctuation\">(</span>repoURL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> folderDestination <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>outputFolderPath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>owner<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">-</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>fs<span class=\"token punctuation\">.</span><span class=\"token function\">existsSync</span><span class=\"token punctuation\">(</span>folderDestination<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      fs<span class=\"token punctuation\">.</span><span class=\"token function\">mkdirSync</span><span class=\"token punctuation\">(</span>folderDestination<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">const</span> markdown <span class=\"token operator\">=</span> turndownService<span class=\"token punctuation\">.</span><span class=\"token function\">turndown</span><span class=\"token punctuation\">(</span>readmeNode<span class=\"token punctuation\">.</span>outerHTML<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">createMarkdownFile</span><span class=\"token punctuation\">(</span>markdown<span class=\"token punctuation\">,</span> folderDestination<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> info <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">URL=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>href<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\\nGIT_URL=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>href<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.git\\nREPO_NAME=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\\nOWNER=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>owner<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">createInfoFile</span><span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">,</span> folderDestination<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Before we are finished with this README, we have to traverse the DOM node to find any other GitHub repository links. This will allow us to follow pages and crawl GitHub. Keep in mind though, there could be a README without any links, and we might want to navigate through GitHub some other way.\nSince we are using jsdom, we can use the built-in getElementsByTagName method. We only want to save valid GitHub links, so we can use a helper function to test with regex. With that, we can create a list of links found.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getLinksFromDOM</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">jsDOM<span class=\"token punctuation\">,</span> isUsableLink</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n     <span class=\"token keyword\">const</span> validLinks <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> linkElements <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>jsDOM <span class=\"token operator\">&amp;&amp;</span> jsDOM<span class=\"token punctuation\">.</span><span class=\"token function\">getElementsByTagName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> linkElements<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> thisElement <span class=\"token operator\">=</span> linkElements<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> thisUrl <span class=\"token operator\">=</span> thisElement<span class=\"token punctuation\">.</span>href<span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isUsableLink</span><span class=\"token punctuation\">(</span>thisUrl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n         validLinks<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>thisUrl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> validLinks<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Great, so far we retrieve README content from a URL and use that to generate a list of new URLs. If we want to continue searching and finding README files, we can follow the links and repeat entire process. This will recursively crawl the GitHub repositories, allowing us to gather data.\nTo keep track of the new URLs to visit, each link needs to be stored in a queue, or in terms of data structures, a (stack)[<a href=\"https://www.geeksforgeeks.org/stack-data-structure/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://www.geeksforgeeks.org/stack-data-structure/</a>]. To implement this, I append all the items of the new list to a file. Whenever the program is ready to fetch the next link, we can pull and remove the first line of the queue file and return it for a new URL string. The link queue will be stored in a file where we append/delete line by line. This was done to avoid storing an array in memory to avoid crashing, and to allow pausing the crawler and any point.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">saveLinkToQueue</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">linkStr<span class=\"token punctuation\">,</span> outputFolderPath<span class=\"token punctuation\">,</span> outputFileName</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">const</span> filePath <span class=\"token operator\">=</span> outputFolderPath <span class=\"token operator\">+</span> outputFileName<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">.</span><span class=\"token function\">existsSync</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      fs<span class=\"token punctuation\">.</span><span class=\"token function\">appendFile</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">,</span> linkStr <span class=\"token operator\">+</span> <span class=\"token string\">\"\\r\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throw</span> err<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      fs<span class=\"token punctuation\">.</span><span class=\"token function\">writeFile</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">,</span> linkStr <span class=\"token operator\">+</span> <span class=\"token string\">\"\\r\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throw</span> err<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>All of these modules together will download README files in an organized output folder. After running the web crawler, we can run a spell checker on the exported data. To do this, I used a package called â€˜<a href=\"https://www.npmjs.com/package/yaspeller\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">yaspeller</a>â€™. Each time I want to correct a README, I can generate a file with all common typos and errors.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">yaspeller -e &quot;.md&quot; ./ --find-repeat-words --ignore-digits --ignore-urls --only-errors &amp;&gt; &quot;spellcheck.txt&quot;</code></pre></div>\n<p>And that's it! I now have a way to look through hundreds of repositories. I can spell check tons of README files and help people remove possibly embarrassing typos. There are many ways to expand on this. You could analyze the languages used, the diction, create a Graph, or even run the data through machine learning algorithms.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">run() {\n    const repositoriesFolder = this.outputFolderPath + \"repositories/\";\n    const linkQueueFile = \"linkQueue.txt\";\n\n    const linkListCallback = async function (linkList) {\n      const outputFolderPath = this.outputFolderPath;\n      if (this.followReadMeLinks) {\n        await linkList.forEach(async (link) => {\n          await saveLinkToQueue(link, outputFolderPath, linkQueueFile);\n        });\n      }\n    }.bind(this);\n\n    let nextURL =await getNextLinkFromQueue(this.outputFolderPath, linkQueueFile\n\n    while (nextURL) {\n      fetchAndProcessRepo(nextURL, repositoriesFolder, linkListCallback);\n      nextURL = await getNextLinkFromQueue(this.outputFolderPath, linkQueueFile);\n    }\n  }</code></pre></div>\n<p>This project is also available on <a href=\"www.npmjs.com/package/readme-crawler\">npm</a>. Install the package and try it yourself!</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> ReadMeCrawler <span class=\"token keyword\">from</span> <span class=\"token string\">'readme-crawler'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> crawler <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ReadMeCrawler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    startUrl<span class=\"token operator\">:</span> <span class=\"token string\">'https://github.com/jnv/lists'</span><span class=\"token punctuation\">,</span>\n    followReadMeLinks<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    outputFolderPath<span class=\"token operator\">:</span> <span class=\"token string\">'./output/'</span>\n <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n crawler<span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Not only was this project fun, but I was able to learn about using Node.js and other npm packages. I spent many hours reading about the 'fs' module, and thinking of different ways to process/store the data. I also tried working with executing commands with Node.js, to run the spell checker synchronously on each result. However, It was difficult to pipe the stdout correctly, and I realized that spell checking was a separate concern apart from web crawling anyways.\nOverall, this was a great learning experience and problem solving exercise.</p>\n<hr>\n<p>View the source code on <a href=\"https://github.com/spencerlepine/readme-crawler\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">GitHub</a>.</p>\n<p>If youâ€™re interested in my work, read more here on my <a href=\"https://spencerlepine.com/blog\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">blog</a>.</p>\n<p>Want to get in touch, Iâ€™d love to talk! Send me an <a href=\"mailto:hello@spencerlepine.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">email</a>.</p>\n<p>Also find me here:</p>\n<ul>\n<li><a href=\"https://twitter.com/SpencerLepine\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Twitter (@spencerlepine)</a></li>\n<li><a href=\"https://github.com/spencerlepine\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">GitHub (@spencerlepine)</a></li>\n<li><a href=\"https://www.linkedin.com/in/spencer-lepine/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">LinkedIn</a></li>\n<li><a href=\"https://www.youtube.com/channel/UCBL6vAHJZqUlyJp-rcFU55Q\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Youtube (Spencer Lepine)</a></li>\n</ul>","frontmatter":{"title":"Building a README Crawler with Node.js","description":"An Overview of the Node.js README Web Crawler project and how I created it.","date":"2021-08-15T00:00:00.000Z","slug":"/blog/building-a-web-crawler-with-node-js","tags":["GitHub","Repositories","Projects","WebCrawler","Node"]}}},"pageContext":{}},"staticQueryHashes":["1033552414","1994492073","2404907192","604461682"]}